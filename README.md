# Система Рекомендации Ставок

Этот проект представляет собой систему рекомендации ставок, которая предлагает оптимальные цены для водителей такси. Он включает в себя модель машинного обучения, обученную на исторических данных, и веб-приложение для предоставления рекомендаций.

## Структура проекта

- `app/`: Содержит веб-приложение Flask.
  - `main.py`: Основной файл приложения, запускающий сервер Flask.
  - `bid_recommender.py`: Основная логика для генерации рекомендаций по ставкам с использованием обученной модели.
  - `templates/index.html`: Фронтенд веб-приложения.
- `data/`: Хранит обработанные данные.
  - `processed_train.csv`: Обработанные данные для обучения.
  - `processed_test.csv`: Обработанные данные для тестирования.
- `model/`: Хранит обученную модель машинного обучения.
  - `bid_recommender_model.joblib`: Обученная модель LightGBM.
- `prepare_data.py`: Скрипт для предварительной обработки исходных данных из `train.csv`.
- `train_model.py`: Скрипт для обучения модели машинного обучения.
- `test_model.py`: Скрипт для тестирования обученной модели.
- `requirements.txt`: Список зависимостей Python для проекта.
- `train.csv`: Исходные данные для обучения.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository-url>
    cd <repository-name>
    ```

2.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv .venv
    source .venv/bin/activate  # В Windows используйте `.venv\Scripts\activate`
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

## Использование

### 1. Подготовка данных

Запустите скрипт `prepare_data.py` для обработки исходных данных и создания наборов данных для обучения и тестирования.

```bash
python prepare_data.py
```

Это создаст директорию `data/` и сохранит в ней обработанные файлы данных.

### 2. Обучение модели

Запустите скрипт `train_model.py` для обучения модели LightGBM.

```bash
python train_model.py
```

Это создаст директорию `model/` и сохранит обученную модель как `bid_recommender_model.joblib`.

### 3. Запуск веб-приложения

Запустите веб-приложение Flask, выполнив `app/main.py`.

```bash
python app/main.py
```

Приложение будет доступно по адресу `http://127.0.0.1:8961`.

## Веб-интерфейс

Веб-интерфейс позволяет получать рекомендации по ставкам, предоставляя следующую информацию:

-   **Начальная цена (местная):** Начальная цена заказа.
-   **Платформа:** Платформа пользователя (например, Android, iOS).
-   **Класс автомобиля:** Класс автомобиля (например, эконом, комфорт, бизнес).
-   **Дата регистрации водителя:** Дата регистрации водителя.

Приложение предоставит список рекомендуемых цен на ставки с соответствующими вероятностями успеха и ожидаемым доходом.

## API

### `POST /recommend_price`

Эта конечная точка принимает данные заказа в формате JSON и возвращает список рекомендуемых ставок.

**Параметры запроса:**

-   `start_price_local` (float): Начальная цена заказа.
-   `platform` (str): Платформа пользователя.
-   `car_class` (str): Класс автомобиля.
-   `driver_registration_date` (str): Дата регистрации водителя (в формате `YYYY-MM-DD`).

**Пример запроса:**

```json
{
  "start_price_local": 100.0,
  "platform": "android",
  "car_class": "econom",
  "driver_registration_date": "2023-01-01"
}
```

**Пример ответа:**

```json
{
  "recommendations": [
    {
      "bid": 105.0,
      "probability": 0.85,
      "expected_income": 89.25
    },
    {
      "bid": 110.0,
      "probability": 0.75,
      "expected_income": 82.5
    }
  ]
}
```
